<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta name="autor" content="Omar Costa Hamido">
	<meta name="description" content="Ciencia Vitae is the mandatory CV platform for FCT grantees. This website contains a Ciencia Vitae XML export parser, that saves the content in a table format.">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.1/css/all.min.css" integrity="sha512-MV7K8+y+gLIBoVD59lQIYicR65iaqukzvf/nwasF0nqhPay5w/9lJmVM2hMDcnK1OnMGCdVK+iQrJ7lzPJQd1w==" crossorigin="anonymous" referrerpolicy="no-referrer" />
	<title>Ciencia Vitae XML parser</title>
</head>
<body style="font-family: Avenir;">
	<h1>Ciencia Vitae XML parser <a href="https://github.com/omarcostahamido/CienciaVitaeXMLparser" style="color: black;"><i class="fa-brands fa-github"></i></a></h1>
	<input type="file" id="fileinput" />
	<button id="parse" onclick="initialscope()" style="display: none; background: lawngreen;"> PARSE! </button>
	<div id="log"></div>
    <script type="text/javascript">
		var content, parser, xmlDoc, depthspace;
		parser = new DOMParser();
		const space = "&nbsp;&nbsp;&nbsp;&nbsp;";
		var log = "";

		function readSingleFile(evt) {
			//Retrieve the first (and only!) File from the FileList object
			var f = evt.target.files[0]; 

			if (f) {
			  var r = new FileReader();
			  r.onload = function(e) { 
			      content = e.target.result;
			      console.log( "Got the file.\n" 
			            +"name: " + f.name + "\n"
			            +"type: " + f.type + "\n"
			            +"size: " + f.size + " bytes\n"
			            // + "starts with: " + content.substr(1, content.indexOf("\n"))
			            + "starts with: " + content.substr(1, 100)
			            + "..."
			            );  
			      xmlDoc = parser.parseFromString(content,"text/xml");
			      // document.getElementById('parse').value = content;
			      document.getElementById('parse').style.display = 'inline-block';
			  }
			  r.readAsText(f);
			  // print2console();
  
			  // document.getElementById("demo").innerHTML =
			  // xmlDoc.getElementsByTagName("title")[0].childNodes[0].nodeValue;

			} else { 
			  alert("Failed to load file");
			}
		}

		document.getElementById('fileinput').addEventListener('change', readSingleFile, false);

		function indentation(depth){
			var result = "";
			for (var i = 1; i < depth; i++) {
				result += space;
			}
			return result;
		}
		function iterateAndPrint(elem,depth){
			if (elem.childNodes) {
				for (var i = 0, count = elem.childNodes.length, thisdepth = depth+1; i < count; i++) {
					// console.log("elem.childNodes.length: ",elem.childNodes.length);
					if (elem.childNodes[i].nodeName != "#text") {
						console.log(elem.childNodes[i].nodeName," depth: ",thisdepth);
						log += indentation(thisdepth)+elem.childNodes[i].nodeName+" depth: "+thisdepth+"<br>";
						iterateAndPrint(elem.childNodes[i],thisdepth);
					} else {
						console.log(elem.innerHTML," depth: ",thisdepth);
						log += "<strong>"+indentation(thisdepth)+elem.innerHTML+"</strong>"+"<br>";
					}
				}
			}
		}

		function initialscope(){
			curr = xmlDoc.getElementsByTagName("curriculum:curriculum")[0];
			iterateAndPrint(curr,0);
			document.getElementById('log').innerHTML = log;
		}

    </script>
    <br>
    
</body>
</html>